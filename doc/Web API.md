# Web API

This document outlines the endpoints that are available when running gactar as a web server (i.e. by passing `-w` on the command line).

**Important Note:** The web API is intended for _local use only_. It should not be used to expose gactar to the internet. It is not designed for security or to prevent abuse.

# General

## /version

Get the version of gactar being run.

### Parameters

&nbsp;&nbsp;&nbsp;(none)

### Returns

**version** string

&nbsp;&nbsp;&nbsp;The current version tag when gactar was built.

### Example

```
http://localhost:8181/version
```

Result:

```json
{
  "version": "v0.2.0"
}
```

## /run

### Parameters

**amod** string

&nbsp;&nbsp;&nbsp;The amod code to run.

**goal** string

&nbsp;&nbsp;&nbsp;The initial goal.

### Returns

Map of results - one entry for each framework that was run.

**modelName** string

&nbsp;&nbsp;&nbsp;The name of the model (comes from the amod code).

**code** string

&nbsp;&nbsp;&nbsp;The generated code for the given framework.

**output** string

&nbsp;&nbsp;&nbsp;The output of running the model on the framework.

### Example

```
 http://localhost:8181/run
```

Request payload:

```json
{
  "amod": "==model==\nname: count\n ...",
  "goal": "countFrom: 2 5 starting"
}
```

Result:

```json
{
  "results": {
    "ccm": {
      "modelName": "count",
      "code": "# Generated by gactar v0.2.0 ...",
      "output": "   0.000 production_match_delay 0 ...\n"
    },
    "pyactr": {
      "modelName": "count",
      "code": "# Generated by gactar v0.2.0 ...",
      "output": "(0, 'PROCEDURAL', 'CONFLICT RESOLUTION') ..."
    },
    "vanilla": {
      "modelName": "count",
      "code": ";;; Generated by gactar v0.2.0 ...",
      "output": "0.000   GOAL                   SET-BUFFER-CHUNK GOAL GOAL NIL ..."
    }
  }
}
```

# Examples

## /examples/list

Get a list of the available examples built-in to the server.

### Parameters

&nbsp;&nbsp;&nbsp;(none)

### Returns

**example_list** string array

&nbsp;&nbsp;&nbsp;The amod file names which may be used with the `/examples/[example_name]` endpoint.

### Example

```
 http://localhost:8181/examples/list
```

Result:

```json
{
  "example_list": [
    "addition.amod",
    "addition2.amod",
    "count.amod",
    "semantic.amod",
    "topdown_parser.amod"
  ]
}
```

## /examples/[example_name]

Get the specified built-in example from the server.

### Parameters

The name of the example (as part of the URL).

### Returns

The amod code for the requested example. (Note that it is not JSON like the other endpoints - it is straight text.)

### Example

```
 http://localhost:8181/examples/count.amod
```

Result:

```
==model==

// The name of the model (used when generating code and for error messages)
name: count

...
```

# Sessions

## /session/begin

### Parameters

&nbsp;&nbsp;&nbsp;(none)

### Returns

**sessionID** integer

&nbsp;&nbsp;&nbsp;The id of the new session.

### Example

```
 http://localhost:8181/session/begin
```

Result:

```json
{
  "sessionID": 1
}
```

## /session/end

### Parameters

**sessionID** integer

&nbsp;&nbsp;&nbsp;The id of the session to end.

### Returns

&nbsp;&nbsp;&nbsp;(none)

### Example

```
 http://localhost:8181/session/end
```

Request payload:

```json
{
  "sessionID": 1
}
```

## /session/runModel

### Parameters

**sessionID** integer

&nbsp;&nbsp;&nbsp;The id of the session.

**modelID** integer

&nbsp;&nbsp;&nbsp;The ID of the model to run.

**buffers** string

&nbsp;&nbsp;&nbsp;The initial contents of the buffers.

**includeCode** boolean

&nbsp;&nbsp;&nbsp;Whether to include the generated code as part of the response. (default: false)

### Returns

Map of results - one entry for each framework that was run.

**modelName** string

&nbsp;&nbsp;&nbsp;The name of the model (comes from the amod code).

**code** string

&nbsp;&nbsp;&nbsp;The generated code for the given framework.

**output** string

&nbsp;&nbsp;&nbsp;The output of running the model on the framework.

**sessionID** integer

&nbsp;&nbsp;&nbsp;The id of the session.

**modelID** integer

&nbsp;&nbsp;&nbsp;The ID of the model which was run.

### Example

```
 http://localhost:8181/session/runModel
```

Request payload:

```json
{
  "sessionID": 1,
  "modelID": 1,
  "buffers": {
    "goal": "countFrom: 2 5 starting"
  }
}
```

Result:

```json
{
  "results": {
    "ccm": {
      "modelName": "count",
      "output": "   0.000 production_match_delay 0 ...\n",
      "sessionID": 7,
      "modelID": 2
    },
    "pyactr": {
      "modelName": "count",
      "output": "(0, 'PROCEDURAL', 'CONFLICT RESOLUTION') ...",
      "sessionID": 7,
      "modelID": 2
    },
    "vanilla": {
      "modelName": "count",
      "output": "0.000   GOAL                   SET-BUFFER-CHUNK GOAL GOAL NIL ...",
      "sessionID": 7,
      "modelID": 2
    }
  }
}
```

# Models

## /model/load

Given a model (amod code), compile and store it on the server. It returns an id to use to reference the model.

### Parameters

**amod** string

&nbsp;&nbsp;&nbsp;The amod code to load.

**sessionID** integer

&nbsp;&nbsp;&nbsp;The id of the session to load this model in.

### Returns

**modelID** integer

&nbsp;&nbsp;&nbsp;The ID of this model to use in other calls to the API.

**modelName** string

&nbsp;&nbsp;&nbsp;The name of the model (comes from the amod code).

**sessionID** integer

&nbsp;&nbsp;&nbsp;The id of the session.

### Example

```
 http://localhost:8181/model/load
```

Request payload:

```json
{
  "amod": "==model==\nname: count\n ...",
  "sessionID": 1
}
```

Result:

```json
{
  "modelID": 1,
  "modelName": "count",
  "sessionID": 1
}
```
